!function(){angular.module("INFOsmog",["controllers","directives"]),angular.module("controllers",["ui.bootstrap","directives","services"]),angular.module("directives",["ui.bootstrap","services"]),angular.module("services",["ngCookies","ngResource"])}(),function(){var e=function(e,t,r,a,n,o){var i=function(){return o.getData(t.counties.selected).then(function(e){for(var r,a,n,o=0;o<e.measurementTypes.length&&(!r||!a);o++)n=e.measurementTypes[o].name,"PM10"===n?r=e.measurementTypes[o]:"NO2"===n&&(a=e.measurementTypes[o]);t.data=t.data||{},t.data.weather=t.data.weather||{},t.data.weather.degree=e.weatherDegree,t.data.weather.type=e.weatherType,t.data.thresholds=t.data.thresholds||{},t.data.thresholds.acceptable=Number.MAX_VALUE,t.data.thresholds.informative=Number.MAX_VALUE,t.data.thresholds.alarm=Number.MAX_VALUE,t.data.chartData=[];var i=function(e){t.data.thresholds.acceptable=Math.min(t.data.thresholds.acceptable,e.thresholds.acceptable),t.data.thresholds.informative=Math.min(t.data.thresholds.informative,e.thresholds.informative),t.data.thresholds.alarm=Math.min(t.data.thresholds.alarm,e.thresholds.alarm);for(var r,a,n=0,o=0;n<t.data.chartData.length&&o<e.measurements.length;)r=t.data.chartData[n].hour,a=e.measurements[o].hour,a>r?n++:r===a?(t.data.chartData[n].value=Math.max(t.data.chartData[n].value,e.measurements[o].value),n++,o++):(t.data.chartData.splice(n,0,{hour:e.measurements[o].hour,value:e.measurements[o].value}),n++,o++);for(var i=o;i<e.measurements.length;i++)t.data.chartData.push({hour:e.measurements[i].hour,value:e.measurements[i].value})};(r||a)&&(r&&a?(i(r),i(a)):i(r||a))})};t.counties={},t.counties.list=[],t.counties.selected=0,t.changeCounty=function(){i(),a.storeId(t.counties.selected)},a.getList().then(function(e){t.counties.list=e,t.counties.selected=a.getId(e)}).then(i).then(n.load).then(function(){var a=moment(t.data.now),n=a.clone();n.endOf("hour");var o=function(e){return 60*e*1e3};r(function(){i(),e(i,o(60))},n.diff(a)+o(15))})};angular.module("controllers").controller("dataCtrl",["$interval","$scope","$timeout","countyService","googleChartsService","smogService",e])}(),function(){var e=function(e,t){var r=function(){return e.data.chartData[e.data.chartData.length-1].value};e.isAcceptable=function(){var t=!0;return e.data&&(t=r()<e.data.thresholds.informative),t},e.isInform=function(){return!e.isAcceptable()&&!e.isAlarm()},e.isAlarm=function(){var t=!1;return e.data&&(t=r()>=e.data.thresholds.alarm),t},e.getBackgroundClass=function(){return{"smog-green":e.isAcceptable(),"smog-yellow":e.isInform(),"smog-red":e.isAlarm()}},e.getExceededPercentage=function(){return e.isAcceptable()?void 0:t.percentage(r(),e.data.thresholds.acceptable)-100}};angular.module("controllers").controller("infoCtrl",["$scope","smogService",e])}(),function(){var e=function(e,t){e.showForm=function(){t.open({size:"signin",scope:e,controller:"signingInFormCtrl",templateUrl:"signingInForm.html"})}};angular.module("controllers").controller("signingInCtrl",["$scope","$uibModal",e])}(),function(){var e=function(e,t,r){var a=function(){e.user={}};e.signIn=function(){r.signIn(e.user)},e.cancel=function(e){e.preventDefault(),t.close(),a()},a()};angular.module("controllers").controller("signingInFormCtrl",["$scope","$uibModalInstance","signingInService",e])}(),function(){var e=function(e,t){t.time="00:00";var r=function(){t.time=moment().format("HH:mm")};r(),e(r,1e3)};angular.module("controllers").controller("timeCtrl",["$interval","$scope",e])}(),function(){var e=function(e){e.type={},e.type.rainy=1,e.type.stormyRainy=2,e.type.cloudyTornado=3,e.type.tornadoThunder=4,e.type.suny=5,e.type.cloudy=6,e.type.snowy=7,e.type.cloud=8,e.type.stormyRainyTornado=9};angular.module("controllers").controller("weatherCtrl",["$scope",e])}(),function(){var e=function(e){return{restrict:"A",scope:{data:"=",acceptableThresold:"=",informativeThreshold:"=",alarmThreshold:"="},link:function(t,r){var a,n=function(){if(a){var r={chart:{title:""},legend:{position:"none"},animation:{startup:!0}},n=e.toSmogDataTable(t.data,t.acceptableThresold,t.informativeThreshold,t.alarmThreshold);a.draw(n,r)}};e.load(!0).then(function(){a=new google.visualization.ColumnChart(r[0]),n()}),t.$watch("data",function(e,t){e!==t&&n()}),$(window).resize(n)}}};angular.module("directives").directive("smogChart",["googleChartsService",e])}(),function(){var e=function(){var e=this;e.port,e.relativePath,e.$get=["$location",function(t){return function(r){var a=t.host()+":"+e.port+"/"+e.relativePath+"/"+r;return"http://"+a.replace(/\/\//g,"/")}}]};angular.module("services").provider("apiUrlService",e)}(),function(){var e=function(e,t){return e(t("county"))};angular.module("services").factory("countyResourceService",["$resource","apiUrlService",e])}(),function(){var e=function(e,t){var r={},a="idCounty";return r.getList=function(){return t.query().$promise},r.getId=function(t){var r=e.get(a);return r=r?+r:t[0].id},r.storeId=function(t){var r=moment();r.add(1,"y"),e.put(a,t,{expires:r.toDate()})},r};angular.module("services").factory("countyService",["$cookies","countyResourceService",e])}(),function(){var e=function(e,t,r){var a={},n=!1,o=!1;return a.load=function(r){var a=t.defer(),i=a.promise;if(n)a.resolve();else if(o||r)var c=e(function(){n&&(e.cancel(c),a.resolve())},100);else o=!0,google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){a.resolve(),n=!0});return i},a.toSmogDataTable=function(e,t,a,n){var o=[];o.push(["Godzina","Poziom",{role:"style"},{role:"annotation"}]);var i,c,u;if(e)for(var s=0;s<e.length;s++)i=e[s],c="#4CAF50",i.value>=n?c="#FF2B00":i.value>=a&&(c="#FFAB00"),u=r.percentage(i.value,t),o.push([("0"+i.hour).slice(-2)+":00",u,c,u+"%"]);return google.visualization.arrayToDataTable(o)},a};angular.module("services").factory("googleChartsService",["$interval","$q","smogService",e])}(),function(){var e=function(e,t){return e(t("signin"))};angular.module("services").factory("signingInResourceService",["$resource","apiUrlService",e])}(),function(){var e=function(e,t){return e(t("county/:id"))};angular.module("services").factory("smogResourceService",["$resource","apiUrlService",e])}(),function(){var e=function(e){var t={};return t.getData=function(t){return e.get({id:t}).$promise},t.percentage=function(e,t){return Math.round(e/t*100)},t};angular.module("services").factory("smogService",["smogResourceService",e])}(),function(){var e=function(e){e.port=80,e.relativePath="api/v1"};angular.module("services").config(["apiUrlServiceProvider",e])}();